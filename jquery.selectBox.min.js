/*
	
	jQuery selectBox (version 1.0.8)
	
		A cosmetic, styleable replacement for SELECT elements.
	
		Homepage:   http://abeautifulsite.net/blog/2011/01/jquery-selectbox-plugin/
		Demo page:  http://labs.abeautifulsite.net/projects/js/jquery/selectBox/
		
		Copyright 2011 Cory LaViska for A Beautiful Site, LLC.
		
	Features:

		- Supports OPTGROUPS
		- Supports standard dropdown controls
		- Supports multi-select controls (i.e. multiple="multiple")
		- Supports inline controls (i.e. size="5")
		- Fully accessible via keyboard
		- Shift + click (or shift + enter) to select a range of options in multi-select controls
		- Type to search when the control has focus
		- Auto-height based on the size attribute (to use, omit the height property in your CSS!)
		- Tested in IE7-IE9, Firefox 3-4, recent webkit browsers, and Opera
	
	
	License:
		
		Licensed under both the MIT license and the GNU GPLv2 (same as jQuery: http://jquery.org/license)
	
	
	Usage:
		
		Link to the JS file:
			
			<script src="jquery.selectbox.min.js" type="text/javascript"></script>
		
		Add the CSS file (or append contents to your own stylesheet):
		
			<link href="jquery.selectbox.min.css" rel="stylesheet" type="text/css" />
		
		To create:
			
			$("SELECT").selectBox([settings]);
	
	
	Settings:
		
		To specify settings, use this syntax: $("SELECT").selectBox('settings', { settingName: value, ... });
			
			menuTransition: ['default', 'slide', 'fade'] - the show/hide transition for dropdown menus
			menuSpeed: [integer, 'slow', 'normal', 'fast'] - the show/hide transition speed
			loopOptions: [boolean] - flag to allow arrow keys to loop through options
	
	
	Methods:
		
		To call a method use this syntax: $("SELECT").selectBox('methodName', [options]);
		
			create - Creates the control (default method)
			destroy - Destroys the selectBox control and reverts back to the original form control
			disable - Disables the control (i.e. disabled="disabled")
			enable - Enables the control
			value - if passed with a value, sets the control to that value; otherwise returns the current value
			options - pass in either a string of HTML or a JSON object to replace the existing options
			control - returns the selectBox control element (an anchor tag) for working with directly
	
	
	Events:
		
		Events are fired on the original select element. You can bind events like this:
			
			$("SELECT").selectBox().change( function() { alert( $(this).val() ); } );
			
			focus - Fired when the control gains focus
			blur - Fired when the control loses focus
			change - Fired when the value of a control changes
	
	
	Change Log:
		
		v1.0.0 (2011-04-03) - Complete rewrite with added support for inline and multi-select controls
		v1.0.1 (2011-04-04) - Fixed options method so it doesn't destroy/recreate the control when called.
		                    - Added a check for iOS devices (their native controls are much better for 
		                      touch-based devices; you can still use selectBox API methods for theme)
		                    - Fixed issue where IE window would lose focus on XP
		                    - Fixed premature selection issue in Webkit browsers
		v1.0.2 (2011-04-13) - Fixed auto-height for inline controls when control is invisible on load
		                    - Removed auto-width for dropdown and inline controls; now relies 100% on CSS
		                      for setting the width
		                   	- Added 'control' method for working directly with the selectBox control
		v1.0.3 (2011-04-22) - Fixed bug in value method that errored if the control didn't exist
		v1.0.4 (2011-04-22) - Fixed bug where controls without any options would render with incorrect heights
		v1.0.5 (2011-04-22) - Removed 'tick' image in lieu of background colors to indicate selection
		                    - Clicking no longer toggles selected/unselected in multi-selects; use CTRL/CMD and 
		                      SHIFT like in normal browser controls
		                    - Fixed bug where inline controls would not receive focus unless tabbed into
		v1.0.6 (2011-04-29) - Fixed bug where inline controls could be "dragged" when selecting an empty area
		v1.0.7 (2011-05-18) - Expanded iOS check to include Android devices as well
		                    - Added autoWidth option; set to false on init to use CSS widths for dropdown menus
		v1.0.8 (2011-11-02) - Added position option to place the dropdown above the control
		                      
	Known Issues:
	
		- The blur and focus callbacks are not very reliable in IE7. The change callback works fine.
	
*/jQuery&&function(a){a.extend(a.fn,{selectBox:function(b,c){var d,e="",f=function(b,c){if(navigator.userAgent.match(/iPad|iPhone|Android/i))return!1;if(b.tagName.toLowerCase()!=="select")return!1;b=a(b);if(b.data("selectBox-control"))return!1;var d=a('<a class="selectBox" />'),e=b.attr("multiple")||parseInt(b.attr("size"))>1,f=c||{};f.autoWidth===undefined&&(f.autoWidth=!0),d.addClass(b.attr("class")).attr("style",b.attr("style")||"").attr("title",b.attr("title")||"").attr("tabindex",parseInt(b.attr("tabindex"))).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&a(document.activeElement).blur();if(d.hasClass("selectBox-active"))return;d.addClass("selectBox-active"),b.trigger("focus")}).bind("blur.selectBox",function(){if(!d.hasClass("selectBox-active"))return;d.removeClass("selectBox-active"),b.trigger("blur")}),b.attr("disabled")&&d.addClass("selectBox-disabled");if(e){var h=g(b,"inline");d.append(h).data("selectBox-options",h).addClass("selectBox-inline").addClass("selectBox-menuShowing").bind("keydown.selectBox",function(a){o(b,a)}).bind("keypress.selectBox",function(a){p(b,a)}).bind("mousedown.selectBox",function(b){a(b.target).is("A.selectBox-inline")&&b.preventDefault(),d.hasClass("selectBox-focus")||d.focus()}).insertAfter(b);if(!b[0].style.height){var k=b.attr("size")?parseInt(b.attr("size")):5,l=d.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");l.find(".selectBox-options").html("<li><a> </a></li>"),optionHeight=parseInt(l.find(".selectBox-options A:first").html("&nbsp;").outerHeight()),l.remove(),d.height(optionHeight*k)}u(d)}else{var m=a('<span class="selectBox-label" />'),n=a('<span class="selectBox-arrow" />');m.text(a(b).find("OPTION:selected").text()||" ");var h=g(b,"dropdown");h.appendTo("BODY"),d.data("selectBox-options",h).addClass("selectBox-dropdown").append(m).append(n).bind("mousedown.selectBox",function(a){d.hasClass("selectBox-menuShowing")?j():(a.stopPropagation(),h.data("selectBox-down-at-x",a.screenX).data("selectBox-down-at-y",a.screenY),i(b))}).bind("keydown.selectBox",function(a){o(b,a)}).bind("keypress.selectBox",function(a){p(b,a)}).insertAfter(b),u(d)}b.addClass("selectBox").data("selectBox-control",d).data("selectBox-settings",f).hide()},g=function(b,c){var d;switch(c){case"inline":return d=a('<ul class="selectBox-options" />'),b.find("OPTGROUP").length?b.find("OPTGROUP").each(function(){var b=a('<li class="selectBox-optgroup" />');b.text(a(this).attr("label")),d.append(b),a(this).find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).attr("disabled")&&b.addClass("selectBox-disabled"),a(this).attr("selected")&&b.addClass("selectBox-selected"),d.append(b)})}):b.find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).attr("disabled")&&b.addClass("selectBox-disabled"),a(this).attr("selected")&&b.addClass("selectBox-selected"),d.append(b)}),d.find("A").bind("mouseover.selectBox",function(c){l(b,a(this).parent())}).bind("mouseout.selectBox",function(c){m(b,a(this).parent())}).bind("mousedown.selectBox",function(a){a.preventDefault(),b.selectBox("control").hasClass("selectBox-active")||b.selectBox("control").focus()}).bind("mouseup.selectBox",function(c){j(),k(b,a(this).parent(),c)}),u(d),d;case"dropdown":return d=a('<ul class="selectBox-dropdown-menu selectBox-options" />'),b.find("OPTGROUP").length?b.find("OPTGROUP").each(function(){var b=a('<li class="selectBox-optgroup" />');b.text(a(this).attr("label")),d.append(b),a(this).find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).attr("disabled")&&b.addClass("selectBox-disabled"),a(this).attr("selected")&&b.addClass("selectBox-selected"),d.append(b)})}):b.find("OPTION").length>0?b.find("OPTION").each(function(){var b=a("<li />"),c=a("<a />");b.addClass(a(this).attr("class")),c.attr("rel",a(this).val()).text(a(this).text()),b.append(c),a(this).attr("disabled")&&b.addClass("selectBox-disabled"),a(this).attr("selected")&&b.addClass("selectBox-selected"),d.append(b)}):d.append("<li> </li>"),d.data("selectBox-select",b).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(a){a.preventDefault(),a.screenX===d.data("selectBox-down-at-x")&&a.screenY===d.data("selectBox-down-at-y")&&(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),j())}).bind("mouseup.selectBox",function(c){if(c.screenX===d.data("selectBox-down-at-x")&&c.screenY===d.data("selectBox-down-at-y"))return;d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),k(b,a(this).parent()),j()}).bind("mouseover.selectBox",function(c){l(b,a(this).parent())}).bind("mouseout.selectBox",function(c){m(b,a(this).parent())}),u(d),d}},h=function(b){b=a(b);var c=b.data("selectBox-control");if(!c)return;var d=c.data("selectBox-options");d.remove(),c.remove(),b.removeClass("selectBox").removeData("selectBox-control").removeData("selectBox-settings").show()},i=function(b){b=a(b);var c=b.data("selectBox-control"),d=b.data("selectBox-settings"),e=c.data("selectBox-options");if(c.hasClass("selectBox-disabled"))return!1;j(),d.autoWidth?e.css("width",c.innerWidth()):e.innerWidth()<c.innerWidth()&&e.css("width",c.innerWidth()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right")));var f=isNaN(c.css("borderBottomWidth"))?0:parseInt(c.css("borderBottomWidth"));if(d.position&&d.position==="top"){var g=c.hasClass("selectBox-dropdown")?e:e.parent();e.css({top:c.offset().top-g.outerHeight(),left:c.offset().left})}else e.css({top:c.offset().top+c.outerHeight()-f,left:c.offset().left});switch(d.menuTransition){case"fade":e.fadeIn(d.menuSpeed);break;case"slide":e.slideDown(d.menuSpeed);break;default:e.show(d.menuSpeed)}var h=e.find(".selectBox-selected:first");n(b,h,!0),l(b,h),c.addClass("selectBox-menuShowing"),a(document).bind("mousedown.selectBox",function(b){if(a(b.target).parents().andSelf().hasClass("selectBox-options"))return;j()})},j=function(){if(a(".selectBox-dropdown-menu").length===0)return;a(document).unbind("mousedown.selectBox"),a(".selectBox-dropdown-menu").each(function(){var b=a(this),c=b.data("selectBox-select"),d=c.data("selectBox-control"),e=c.data("selectBox-settings");switch(e.menuTransition){case"fade":b.fadeOut(e.menuSpeed);break;case"slide":b.slideUp(e.menuSpeed);break;default:b.hide(e.menuSpeed)}d.removeClass("selectBox-menuShowing")})},k=function(b,c,d){b=a(b),c=a(c);var e=b.data("selectBox-control"),f=b.data("selectBox-settings");if(e.hasClass("selectBox-disabled"))return!1;if(c.length===0||c.hasClass("selectBox-disabled"))return!1;if(b.attr("multiple"))if(d.shiftKey&&e.data("selectBox-last-selected")){c.toggleClass("selectBox-selected");var g;c.index()>e.data("selectBox-last-selected").index()?g=c.siblings().slice(e.data("selectBox-last-selected").index(),c.index()):g=c.siblings().slice(c.index(),e.data("selectBox-last-selected").index()),g=g.not(".selectBox-optgroup, .selectBox-disabled"),c.hasClass("selectBox-selected")?g.addClass("selectBox-selected"):g.removeClass("selectBox-selected")}else d.metaKey?c.toggleClass("selectBox-selected"):(c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected"));else c.siblings().removeClass("selectBox-selected"),c.addClass("selectBox-selected");e.hasClass("selectBox-dropdown")&&e.find(".selectBox-label").text(c.text());var h=0,i=[];return b.attr("multiple")?e.find(".selectBox-selected A").each(function(){i[h++]=a(this).attr("rel")}):i=c.find("A").attr("rel"),e.data("selectBox-last-selected",c),b.val()!==i&&(b.val(i),b.trigger("change")),!0},l=function(b,c){b=a(b),c=a(c);var d=b.data("selectBox-control"),e=d.data("selectBox-options");e.find(".selectBox-hover").removeClass("selectBox-hover"),c.addClass("selectBox-hover")},m=function(b,c){b=a(b),c=a(c);var d=b.data("selectBox-control"),e=d.data("selectBox-options");e.find(".selectBox-hover").removeClass("selectBox-hover")},n=function(b,c,d){if(!c||c.length===0)return;b=a(b);var e=b.data("selectBox-control"),f=e.data("selectBox-options"),g=e.hasClass("selectBox-dropdown")?f:f.parent(),h=parseInt(c.offset().top-g.position().top),i=parseInt(h+c.outerHeight());d?g.scrollTop(c.offset().top-g.offset().top+g.scrollTop()-g.height()/2):(h<0&&g.scrollTop(c.offset().top-g.offset().top+g.scrollTop()),i>g.height()&&g.scrollTop(c.offset().top+c.outerHeight()-g.offset().top+g.scrollTop()-g.height()))},o=function(b,c){b=a(b);var d=b.data("selectBox-control"),f=d.data("selectBox-options"),g=b.data("selectBox-settings"),h=0,o=0;if(d.hasClass("selectBox-disabled"))return;switch(c.keyCode){case 8:c.preventDefault(),e="";break;case 9:case 27:j(),m(b);break;case 13:d.hasClass("selectBox-menuShowing")?(k(b,f.find("LI.selectBox-hover:first"),c),d.hasClass("selectBox-dropdown")&&j()):i(b);break;case 38:case 37:c.preventDefault();if(d.hasClass("selectBox-menuShowing")){var p=f.find(".selectBox-hover").prev("LI");h=f.find("LI:not(.selectBox-optgroup)").length,o=0;while(p.length===0||p.hasClass("selectBox-disabled")||p.hasClass("selectBox-optgroup")){p=p.prev("LI"),p.length===0&&(g.loopOptions?p=f.find("LI:last"):p=f.find("LI:first"));if(++o>=h)break}l(b,p),k(b,p,c),n(b,p)}else i(b);break;case 40:case 39:c.preventDefault();if(d.hasClass("selectBox-menuShowing")){var q=f.find(".selectBox-hover").next("LI");h=f.find("LI:not(.selectBox-optgroup)").length,o=0;while(q.length===0||q.hasClass("selectBox-disabled")||q.hasClass("selectBox-optgroup")){q=q.next("LI"),q.length===0&&(g.loopOptions?q=f.find("LI:first"):q=f.find("LI:last"));if(++o>=h)break}l(b,q),k(b,q,c),n(b,q)}else i(b)}},p=function(b,c){b=a(b);var f=b.data("selectBox-control"),g=f.data("selectBox-options");if(f.hasClass("selectBox-disabled"))return;switch(c.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:f.hasClass("selectBox-menuShowing")||i(b),c.preventDefault(),clearTimeout(d),e+=String.fromCharCode(c.charCode||c.keyCode),g.find("A").each(function(){if(a(this).text().substr(0,e.length).toLowerCase()===e.toLowerCase())return l(b,a(this).parent()),n(b,a(this).parent()),!1}),d=setTimeout(function(){e=""},1e3)}},q=function(b){b=a(b),b.attr("disabled",!1);var c=b.data("selectBox-control");if(!c)return;c.removeClass("selectBox-disabled")},r=function(b){b=a(b),b.attr("disabled",!0);var c=b.data("selectBox-control");if(!c)return;c.addClass("selectBox-disabled")},s=function(b,c){b=a(b),b.val(c),c=b.val();var d=b.data("selectBox-control");if(!d)return;var e=b.data("selectBox-settings"),f=d.data("selectBox-options");d.find(".selectBox-label").text(a(b).find("OPTION:selected").text()||" "),f.find(".selectBox-selected").removeClass("selectBox-selected"),f.find("A").each(function(){if(typeof c=="object")for(var b=0;b<c.length;b++)a(this).attr("rel")==c[b]&&a(this).parent().addClass("selectBox-selected");else a(this).attr("rel")==c&&a(this).parent().addClass("selectBox-selected")}),e.change&&e.change.call(b)},t=function(b,d){b=a(b);var e=b.data("selectBox-control"),f=b.data("selectBox-settings");switch(typeof c){case"string":b.html(c);break;case"object":b.html("");for(var h in c){if(c[h]===null)continue;if(typeof c[h]=="object"){var i=a('<optgroup label="'+h+'" />');for(var j in c[h])i.append('<option value="'+j+'">'+c[h][j]+"</option>");b.append(i)}else{var k=a('<option value="'+h+'">'+c[h]+"</option>");b.append(k)}}}if(!e)return;e.data("selectBox-options").remove();var l=e.hasClass("selectBox-dropdown")?"dropdown":"inline",d=g(b,l);e.data("selectBox-options",d);switch(l){case"inline":e.append(d);break;case"dropdown":e.find(".selectBox-label").text(a(b).find("OPTION:selected").text()||" "),a("BODY").append(d)}},u=function(b){a(b).css("MozUserSelect","none").bind("selectstart",function(a){a.preventDefault()})};switch(b){case"control":return a(this).data("selectBox-control");case"settings":if(!c)return a(this).data("selectBox-settings");a(this).each(function(){a(this).data("selectBox-settings",a.extend(!0,a(this).data("selectBox-settings"),c))});break;case"options":a(this).each(function(){t(this,c)});break;case"value":if(c===undefined)return a(this).val();a(this).each(function(){s(this,c)});break;case"enable":a(this).each(function(){q(this)});break;case"disable":a(this).each(function(){r(this)});break;case"destroy":a(this).each(function(){h(this)});break;default:a(this).each(function(){f(this,b)})}return a(this)}})}(jQuery);